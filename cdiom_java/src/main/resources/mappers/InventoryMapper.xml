<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cdiom.backend.mapper.InventoryMapper">

    <!-- 分页查询库存（包含药品信息） -->
    <select id="selectPageWithDrugInfo" resultType="com.cdiom.backend.model.Inventory">
        SELECT i.*, d.drug_name, d.drug_code, d.unit, d.category FROM inventory i
        LEFT JOIN drug_info d ON i.drug_id = d.id WHERE i.status = 1
        <if test="drugName != null and drugName != ''">
            AND d.drug_name LIKE CONCAT('%', #{drugName}, '%')
        </if>
        <if test="drugCode != null and drugCode != ''">
            AND d.drug_code LIKE CONCAT('%', #{drugCode}, '%')
        </if>
        <if test="location != null and location != ''">
            AND i.location LIKE CONCAT('%', #{location}, '%')
        </if>
        ORDER BY i.create_time DESC
    </select>

</mapper>